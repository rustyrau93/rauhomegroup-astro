---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout 
  title="Mortgage Calculator"
  description="Calculate your monthly mortgage payment with Rusty Rau's free mortgage calculator. Estimate payments for San Diego homes."
>
  <!-- Page Header -->
  <section class="page-header">
    <div class="container">
      <h1>Mortgage Calculator</h1>
      <p>Estimate your monthly payment and see what you can afford</p>
    </div>
  </section>

  <!-- Calculator Section -->
  <section class="calculator-page">
    <div class="container">
      <div class="calculator-grid">
        <div class="calculator-content">
          <h2>Plan Your Purchase</h2>
          <p>Use this calculator to estimate your monthly mortgage payment. Remember, this is just an estimate - for accurate numbers and to get pre-approved, I can connect you with trusted local lenders.</p>
          <div class="calculator-note">
            <i class="fas fa-info-circle"></i>
            <span>Need help with financing? I work with several excellent lenders who can get you pre-approved quickly and find the best rates.</span>
          </div>
          <a href="/contact" class="cta-button secondary">Talk to Rusty</a>
        </div>
        <div class="calculator-tool">
          <form class="mortgage-calculator" id="mortgage-calculator">
            <div class="calc-group">
              <label for="home-price">Home Price</label>
              <div class="input-with-prefix">
                <span>$</span>
                <input type="number" id="home-price" value="850000" min="100000" step="10000">
              </div>
              <input type="range" id="price-slider" min="200000" max="3000000" value="850000" step="10000">
            </div>
            <div class="calc-group">
              <label>Down Payment</label>
              <div class="calc-row">
                <div class="input-with-prefix">
                  <span>$</span>
                  <input type="number" id="down-payment" value="170000">
                </div>
                <div class="input-with-suffix">
                  <input type="number" id="down-percent" value="20" min="0" max="100">
                  <span>%</span>
                </div>
              </div>
            </div>
            <div class="calc-row">
              <div class="calc-group half">
                <label for="interest-rate">Interest Rate</label>
                <div class="input-with-suffix">
                  <input type="number" id="interest-rate" value="6.5" step="0.125" min="0" max="15">
                  <span>%</span>
                </div>
              </div>
              <div class="calc-group half">
                <label for="loan-term">Loan Term</label>
                <select id="loan-term">
                  <option value="30">30 years</option>
                  <option value="15">15 years</option>
                  <option value="20">20 years</option>
                </select>
              </div>
            </div>
            <div class="calc-row">
              <div class="calc-group half">
                <label for="tax-rate">Property Tax Rate</label>
                <div class="input-with-suffix">
                  <input type="number" id="tax-rate" value="1.1" step="0.1" min="0" max="5">
                  <span>%</span>
                </div>
              </div>
              <div class="calc-group half">
                <label for="hoa-fee">HOA (Monthly)</label>
                <div class="input-with-prefix">
                  <span>$</span>
                  <input type="number" id="hoa-fee" value="0" step="25" min="0">
                </div>
              </div>
            </div>
            <button type="button" id="calc-button" class="cta-button calc-btn">Calculate Payment</button>
            <div class="calc-result">
              <span class="calc-result-label">Estimated Monthly Payment</span>
              <span class="calc-result-value" id="monthly-payment">--</span>
              <span class="calc-result-note">Includes principal, interest, taxes & HOA. Insurance not calculated.</span>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <Fragment slot="scripts">
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const homePrice = document.getElementById('home-price') as HTMLInputElement;
        const priceSlider = document.getElementById('price-slider') as HTMLInputElement;
        const downPayment = document.getElementById('down-payment') as HTMLInputElement;
        const downPercent = document.getElementById('down-percent') as HTMLInputElement;
        const interestRate = document.getElementById('interest-rate') as HTMLInputElement;
        const loanTerm = document.getElementById('loan-term') as HTMLSelectElement;
        const taxRate = document.getElementById('tax-rate') as HTMLInputElement;
        const hoaFee = document.getElementById('hoa-fee') as HTMLInputElement;
        const calcButton = document.getElementById('calc-button');
        const monthlyPaymentEl = document.getElementById('monthly-payment');
        
        // Sync price slider with input
        priceSlider?.addEventListener('input', () => {
          if (homePrice) homePrice.value = priceSlider.value;
          updateDownPayment();
        });
        
        homePrice?.addEventListener('input', () => {
          if (priceSlider) priceSlider.value = homePrice.value;
          updateDownPayment();
        });
        
        // Update down payment when percentage changes
        downPercent?.addEventListener('input', updateDownPayment);
        
        function updateDownPayment() {
          const price = parseFloat(homePrice?.value || '0');
          const percent = parseFloat(downPercent?.value || '0');
          if (downPayment) downPayment.value = Math.round(price * percent / 100).toString();
        }
        
        // Update percentage when down payment changes
        downPayment?.addEventListener('input', () => {
          const price = parseFloat(homePrice?.value || '0');
          const down = parseFloat(downPayment?.value || '0');
          if (downPercent && price > 0) {
            downPercent.value = ((down / price) * 100).toFixed(1);
          }
        });
        
        // Calculate mortgage
        calcButton?.addEventListener('click', calculate);
        
        function calculate() {
          const price = parseFloat(homePrice?.value || '0');
          const down = parseFloat(downPayment?.value || '0');
          const rate = parseFloat(interestRate?.value || '0') / 100 / 12;
          const term = parseInt(loanTerm?.value || '30') * 12;
          const tax = parseFloat(taxRate?.value || '0') / 100 / 12;
          const hoa = parseFloat(hoaFee?.value || '0');
          
          const principal = price - down;
          
          // Monthly principal & interest
          let monthlyPI: number;
          if (rate === 0) {
            monthlyPI = principal / term;
          } else {
            monthlyPI = principal * (rate * Math.pow(1 + rate, term)) / (Math.pow(1 + rate, term) - 1);
          }
          
          // Monthly property tax
          const monthlyTax = price * tax;
          
          // Total monthly payment
          const totalMonthly = monthlyPI + monthlyTax + hoa;
          
          if (monthlyPaymentEl) {
            monthlyPaymentEl.textContent = '$' + totalMonthly.toLocaleString('en-US', {
              minimumFractionDigits: 0,
              maximumFractionDigits: 0
            });
          }
        }
        
        // Calculate on load
        calculate();
      });
    </script>
  </Fragment>
</BaseLayout>

<style>
  .page-header {
    background: var(--color-primary);
    color: var(--color-white);
    padding: 6rem 0 4rem;
    text-align: center;
  }
  
  .page-header h1 {
    font-family: var(--font-display);
    font-size: 3rem;
    margin-bottom: 0.5rem;
  }
  
  .page-header p {
    color: var(--color-gold);
    font-size: 1.25rem;
  }
  
  .calculator-page {
    padding: var(--spacing-xl) 0;
  }
  
  .calculator-grid {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 4rem;
    align-items: start;
  }
  
  @media (max-width: 900px) {
    .calculator-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .calculator-content h2 {
    font-family: var(--font-display);
    font-size: 2rem;
    margin-bottom: 1rem;
  }
  
  .calculator-content p {
    color: var(--color-gray);
    line-height: 1.8;
    margin-bottom: 1.5rem;
  }
  
  .calculator-note {
    background: var(--color-off-white);
    padding: 1rem;
    border-radius: 8px;
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    color: var(--color-gray);
  }
  
  .calculator-note i {
    color: var(--color-gold);
  }
  
  .calculator-tool {
    background: var(--color-off-white);
    padding: 2rem;
    border-radius: 12px;
  }
  
  .mortgage-calculator {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  .calc-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .calc-group label {
    font-weight: 500;
    color: var(--color-primary);
  }
  
  .calc-group.half {
    flex: 1;
  }
  
  .calc-row {
    display: flex;
    gap: 1rem;
  }
  
  .input-with-prefix,
  .input-with-suffix {
    display: flex;
    align-items: center;
    background: white;
    border: 1px solid var(--color-light-gray);
    border-radius: 8px;
    overflow: hidden;
  }
  
  .input-with-prefix span,
  .input-with-suffix span {
    padding: 0 0.75rem;
    color: var(--color-gray);
    background: #f8f9fa;
  }
  
  .input-with-prefix input,
  .input-with-suffix input {
    border: none;
    padding: 0.75rem;
    width: 100%;
    font-size: 1rem;
  }
  
  .input-with-prefix input:focus,
  .input-with-suffix input:focus {
    outline: none;
  }
  
  input[type="range"] {
    width: 100%;
    margin-top: 0.5rem;
  }
  
  select {
    padding: 0.75rem;
    border: 1px solid var(--color-light-gray);
    border-radius: 8px;
    font-size: 1rem;
    width: 100%;
  }
  
  .calc-btn {
    margin-top: 0.5rem;
  }
  
  .calc-result {
    background: var(--color-primary);
    color: var(--color-white);
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
  }
  
  .calc-result-label {
    display: block;
    font-size: 0.875rem;
    opacity: 0.8;
    margin-bottom: 0.5rem;
  }
  
  .calc-result-value {
    display: block;
    font-family: var(--font-display);
    font-size: 2.5rem;
    font-weight: 600;
    color: var(--color-gold);
    margin-bottom: 0.5rem;
  }
  
  .calc-result-note {
    display: block;
    font-size: 0.75rem;
    opacity: 0.7;
  }
</style>
